<div class="d-flex h-100" id="wrapper">
  <app-sidebar
    [availableSkills]="availableSkills"
    [availableLocations]="availableLocations"
    [selectedSkills]="selectedSkills"
    [selectedLocations]="selectedLocations"
    [salary]="salary"
    [years]="years"
    (selectedSkillsChange)="onSkillsChange($event)"
    (selectedLocationsChange)="onLocationsChange($event)"
    (salaryChange)="onSalaryChange($event)"
    (yearsChange)="onYearsChange($event)"
    (okButtonClicked)="onOkButtonClicked($event)"
    (reset)="resetFilters()"
    (closeSidebar)="toggleSidebar()"
    #sidebarRef
    [class.show]="sidebarOpen"
    class="sidebar-component"
    [style.left]="isMobile ? (sidebarOpen ? '0px' : '-280px') : '0px'"
    [style.position]="isMobile ? 'fixed' : 'sticky'"
    [style.z-index]="isMobile ? '1050' : 'auto'"
    [style.width]="isMobile ? '280px' : '250px'"
    [style.height]="isMobile ? '100vh' : '100vh'"
    [style.top]="'0'"
    [style.transition]="isMobile ? 'left 0.3s ease-in-out' : 'none'"
    [style.display]="'block'"
    [style.visibility]="'visible'"
    [style.opacity]="'1'"
  ></app-sidebar>

  <!-- Mobile overlay for sidebar -->
  <div *ngIf="sidebarOpen" class="mobile-overlay d-lg-none" (click)="toggleSidebar()"></div>

  <div id="page-content-wrapper" class="flex-grow-1">
    <app-navbar [showShortlistButton]="filteredCandidates.length > 0" (runShortlist)="runAutoShortlist()" (toggleSidebar)="toggleSidebar()" (refreshData)="refreshData()"></app-navbar>

    <div class="container-fluid mt-3 pb-4">
      <div *ngIf="loading" class="alert alert-info">
        <i class="bi bi-hourglass-split me-2"></i>Loading candidates...
      </div>

      <div *ngIf="!loading && allCandidates.length === 0" class="alert alert-warning">
        <i class="bi bi-exclamation-triangle me-2"></i>
        No candidates loaded. Please check your internet connection and try refreshing.
        <button class="btn btn-sm btn-outline-warning ms-2" (click)="refreshData()">
          <i class="bi bi-arrow-clockwise me-1"></i>Retry
        </button>
      </div>

      <div *ngIf="!loading && allCandidates.length > 0">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs custom-tabs mb-4" id="candidateTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link custom-tab-btn" 
                    [class.active]="activeTab === 'results'"
                    (click)="setActiveTab('results')"
                    type="button">
              <i class="bi bi-people me-2"></i>Candidate Results ({{ filteredCandidates.length }})
            </button>
          </li>
          <li class="nav-item" role="presentation" *ngIf="filteredCandidates.length > 0">
            <button class="nav-link custom-tab-btn" 
                    [class.active]="activeTab === 'shortlist'"
                    (click)="setActiveTab('shortlist')"
                    type="button">
              <i class="bi bi-star me-2"></i>Shortlist Summary ({{ shortlisted.length }})
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="candidateTabsContent">
          <!-- Candidate Results Tab -->
          <div *ngIf="activeTab === 'results'" class="tab-pane fade show active" id="results" role="tabpanel" aria-labelledby="results-tab">
            <div class="row">
              <div class="col-12">
                <div *ngIf="filteredCandidates.length === 0" class="no-candidates-message text-center py-5">
                  <div class="card border-0 shadow-sm">
                    <div class="card-body py-5">
                      <i class="bi bi-search text-muted" style="font-size: 4rem;"></i>
                      <h4 class="text-muted mt-3 mb-3">No Candidates Found</h4>
                      <p class="text-muted mb-4">
                        No candidates match your current filter criteria. Try adjusting your filters to see more results.
                      </p>
                    </div>
                  </div>
                </div>

                <div *ngFor="let c of filteredCandidates; let i = index; trackBy: trackByCandidate" 
                     class="card mb-3 shadow-sm p-3 candidate-card" 
                     [ngClass]="{'card-primary': i % 2 === 0, 'card-secondary': i % 2 === 1}">
                  <h6><b>Name: </b>{{c.name || ''}}</h6>
                  <p><b>Email: </b>{{c.email || ''}}</p>
                  <p><b>Skills:</b> {{ (c.skills || []).join(', ') }}</p>
                  <p><b>Location:</b> {{ (c.location || '—') }}</p>
                  <p><b>Salary Expectation:</b> {{ c.salary_number ? ( '$'+c.salary_number) : '—' }}</p>
                  <p><b>Experience:</b> {{ c.years_experience }} years</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Shortlist Summary Tab -->
          <div *ngIf="activeTab === 'shortlist'" class="tab-pane fade show active" id="shortlist" role="tabpanel" aria-labelledby="shortlist-tab">
            <div class="row">
              <div class="col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div *ngIf="!shortlisted.length" class="text-center text-muted py-5">
                      <i class="bi bi-star-fill" style="font-size: 3rem;"></i>
                      <h5>No shortlist yet</h5>
                      <p>Click "Auto Shortlist" to generate your top 5 candidates</p>
                    </div>
                    <div *ngIf="shortlisted.length">
                      <!-- Diversity Summary -->
                      <div class="row mb-4">
                        <div class="col-md-12">
                          <h6 class="text-primary mb-3">
                            <i class="bi bi-bar-chart me-2"></i>Diversity Summary
                          </h6>
                          <div class="row">
                            <div
                              class="col-md-2 col-6 mb-2"
                              *ngFor="let item of diversityMetrics"
                            >
                              <div class="text-center p-2 bg-light rounded">
                                <div class="fw-bold text-{{ item.color }}">{{ item.value }}</div>
                                <small class="text-muted">{{ item.label }}</small>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Shortlisted Candidates -->
                      <h6 class="text-primary mb-3"><i class="bi bi-trophy me-2"></i>Selected Candidates</h6>
                      <div *ngFor="let s of shortlisted; let i = index; trackBy: trackByCandidate" 
                           class="border rounded p-3 mb-3 shortlist-card" 
                           [ngClass]="{'shortlist-primary': i % 2 === 0, 'shortlist-secondary': i % 2 === 1}">
                        <div class="d-flex justify-content-between align-items-start">
                          <div>
                            <div class="fw-semibold"><b>Name: </b>{{(s.name || '') }}</div>
                            <div class="text-muted small"><b>Location: </b>{{(s.location || '') }}</div>
                            <div class="small mt-1">
                              <p class="m-0"><b>Email: </b>{{s.email || ''}}</p>
                              <p class="m-0"><b>Phone: </b>{{s.phone}}</p>
                              <p class="m-0"><b>Salary Expectation:</b> {{ s.salary_number ? ('$' + s.salary_number) : '—' }}</p>
                              <p class="m-0"><b>Experience:</b> {{ s.years_experience }} years</p>
                            </div>
                          </div>
                          <span class="badge bg-primary">Score: {{ s.score }}</span>
                        </div>
                        <div class="small mt-2">
                          <b>Why selected:</b> {{ s.explanation || '—' }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


