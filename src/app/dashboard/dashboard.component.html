<div class="d-flex" id="wrapper">
  <app-sidebar
    [availableSkills]="availableSkills"
    [availableLocations]="availableLocations"
    [selectedSkills]="selectedSkills"
    [selectedLocations]="selectedLocations"
    [minSalary]="minSalary"
    [maxSalary]="maxSalary"
    [years]="years"
    [blindMode]="blindMode"
    (selectedSkillsChange)="selectedSkills=$event"
    (selectedLocationsChange)="selectedLocations=$event"
    (minSalaryChange)="minSalary=$event"
    (maxSalaryChange)="maxSalary=$event"
    (yearsChange)="years=$event"
    (blindModeChange)="blindMode=$event"
    (apply)="applyFilters()"
    (reset)="resetFilters()"
  ></app-sidebar>

  <div id="page-content-wrapper" class="flex-grow-1">
    <app-navbar (toggleBlind)="toggleBlind()" (runShortlist)="runAutoShortlist()"></app-navbar>

    <div class="container-fluid mt-4">
      <div *ngIf="loading" class="alert alert-info">Loading candidates...</div>

      <div class="row" *ngIf="!loading">
        <div class="col-md-7">
          <h5>Candidate Results ({{ filteredCandidates.length }})</h5>
          <div *ngFor="let c of filteredCandidates" class="card mb-3 shadow-sm p-3">
            <h6>{{ blindMode ? 'Candidate' : (c.name || c.email) }}</h6>
            <p><b>Skills:</b> {{ (c.skills || []).join(', ') }}</p>
            <p><b>Location:</b> {{ blindMode ? 'Hidden' : (c.location || '—') }}</p>
            <p><b>Salary Expectation:</b> {{ c.annual_salary_expectation['full-time'] ? ( c.annual_salary_expectation['full-time']) : '—' }}</p>
            <p><b>Experience:</b> {{ c.work_experiences?.length }} years</p>
          </div>
        </div>
        <div class="col-md-5">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title mb-3">Shortlist Summary</h5>
              <div *ngIf="!shortlisted.length" class="text-muted">No shortlist yet. Click Auto Shortlist.</div>
              <div *ngIf="shortlisted.length">
                <ul class="list-unstyled small mb-3">
                  <li><b>Total</b>: {{ diversity?.total }}</li>
                  <li><b>Unique locations</b>: {{ diversity?.uniqueLocations }}</li>
                  <li><b>Avg experience</b>: {{ diversity?.avgExperience }} yrs</li>
                  <li><b>Top-school backgrounds</b>: {{ diversity?.topSchoolCount }}</li>
                  <li><b>Skills covered</b>: {{ diversity?.skillsCovered }}</li>
                </ul>
                <div *ngFor="let s of shortlisted" class="border rounded p-2 mb-2">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <div class="fw-semibold">{{ blindMode ? 'Candidate' : (s.name || s.email) }}</div>
                      <div class="text-muted small">{{ blindMode ? '' : (s.location || '') }}</div>
                      <div class="small mt-1">
                        <p><b>Salary Expectation:</b> {{ s.annual_salary_expectation['full-time'] ? ('$' + s.annual_salary_expectation['full-time']) : '—' }}</p>
            <p><b>Experience:</b> {{ s.work_experiences?.length }} years</p>
                      </div>
                    </div>
                    <span class="badge bg-primary">Score: {{ s.score }}</span>
                  </div>
                  <div class="small mt-2">
                    <b>Why selected:</b> {{ s.explanation || '—' }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


